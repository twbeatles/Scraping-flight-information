# ✈️ Flight Bot v2.5

**Playwright 기반 실시간 항공권 최저가 비교 분석 도구**

인터파크 항공권을 자동으로 검색하여 최저가를 찾아주는 PyQt6 기반 데스크톱 애플리케이션입니다.

![Python](https://img.shields.io/badge/Python-3.10%2B-blue)
![PyQt6](https://img.shields.io/badge/GUI-PyQt6-green)
![Playwright](https://img.shields.io/badge/Scraper-Playwright-orange)
![License](https://img.shields.io/badge/License-MIT-yellow)

---

## 📋 목차

1. [주요 기능](#-주요-기능)
2. [스크린샷](#-스크린샷)
3. [설치 방법](#️-설치-방법)
4. [사용 방법](#-사용-방법)
5. [고급 기능](#-고급-기능)
6. [키보드 단축키](#️-키보드-단축키)
7. [프로젝트 구조](#-프로젝트-구조)
8. [설정](#-설정)
9. [빌드 (EXE 생성)](#-빌드-exe-생성)
10. [문제 해결](#-문제-해결)
11. [변경 로그](#-변경-로그)
12. [기여](#-기여)

---

## � 주요 기능

### �🔍 검색 기능
- **국내선/국제선** 항공권 검색
- **왕복/편도** 검색 지원
- **좌석 등급** 선택 (이코노미/비즈니스/일등석)
- **다중 목적지** 동시 검색 (최대 5개 목적지 비교)
- **날짜 범위** 검색으로 최저가 날짜 찾기
- **수동 모드** 자동 추출 실패 시 브라우저 유지, 수동 추출/닫기 지원

### 📊 분석 기능
- **실시간 가격 비교** (최대 1,000개 결과)
- **가격 색상 코딩** (녹색: 저가 ~20%, 노랑: 중간, 빨강: 고가 80%~)
- **캘린더뷰** - 날짜별 최저가 시각화
- **필터링** - 직항/경유, 항공사 유형(LCC/FSC), 시간대, 가격대

### 💾 관리 기능
- **즐겨찾기** - 관심 항공편 저장 및 메모
- **검색 기록** - 이전 검색 조건 복원
- **세션 저장/불러오기** - 검색 결과 JSON 파일로 저장
- **가격 알림** - 목표 가격 이하 도달 시 알림
- **CSV/Excel 내보내기** - 결과 파일 저장

### 🎨 UI/UX
- **모던 다크 테마** (라이트 테마 전환 가능)
- **프리미엄 그라데이션** 버튼 및 glassmorphism 효과
- **반응형 레이아웃** - 다양한 화면 크기 지원
- **키보드 단축키** 지원
- **HiDPI(고해상도)** 디스플레이 지원

---

## 📸 스크린샷

> 프로그램 실행 시 모던한 다크 테마의 인터페이스가 표시됩니다.
> - 상단: 검색 조건 입력 패널
> - 중앙: 필터 및 검색 진행 상태
> - 하단: 결과 테이블 / 즐겨찾기 / 로그 탭

---

## 🛠️ 설치 방법

### 시스템 요구 사항
- **운영체제**: Windows 10/11
- **Python**: 3.10 이상
- **브라우저**: Chrome, Edge, 또는 Chromium 중 하나

### 1단계: 저장소 클론 또는 다운로드

```bash
git clone https://github.com/your-repo/flight-bot-v2.git
cd flight-bot-v2
```

### 2단계: 가상 환경 생성 (권장)

```bash
python -m venv venv
venv\Scripts\activate  # Windows
```

### 3단계: 의존성 설치

```bash
pip install -r requirements.txt
```

> `openpyxl`(Excel 입출력)과 `pytest`(테스트)는 `requirements.txt`에 포함되어 함께 설치됩니다.

### 4단계: Playwright 브라우저 설치

```bash
playwright install chromium
```

> **참고**: Chrome이나 Edge가 이미 설치되어 있다면 자동으로 해당 브라우저를 사용합니다.

### 5단계: 실행

```bash
python gui_v2.py
```

---

## � 사용 방법

### 기본 검색

1. **출발지 선택**: 드롭다운에서 출발 공항 선택 (예: ICN 인천)
2. **도착지 선택**: 드롭다운에서 도착 공항 선택 (예: NRT 나리타)
   - 직접 입력 시 **3자리 영문 코드**만 허용됩니다.
3. **여정 유형 선택**: 
   - 왕복: 가는 날 + 오는 날 모두 선택
   - 편도: 가는 날만 선택
4. **노선 유형 선택**:
   - 🇰🇷 국내선: 국내 공항 간 이동 (서울 ↔ 제주 등)
   - ✈️ 국제선: 해외 공항 이동
5. **날짜 선택**: 캘린더에서 출발일/귀국일 선택
6. **인원 설정**: 성인 인원 수 입력 (1-9명)
7. **좌석 등급 선택**: 이코노미/비즈니스/일등석
8. **🔍 검색 버튼 클릭** 또는 `Ctrl+Enter`

### 검색 결과 활용

| 작업 | 방법 |
|------|------|
| 예약 페이지 열기 | 결과 행 **더블클릭** |
| 즐겨찾기 추가 | 행 **우클릭** → "⭐ 즐겨찾기 추가" |
| 정보 복사 | 행 **우클릭** → "📋 정보 복사" |
| 정렬 | 컬럼 헤더 클릭 (가격, 시간 등) |
| 상세 보기 | 마우스 오버 시 툴팁 표시 |

### 필터 사용법

1. **직항만**: 경유 없는 노선만 표시
2. **경유 포함**: 경유 노선도 함께 표시
3. **항공사 유형**:
   - 전체: 모든 항공사
   - 🏷️ LCC: 저비용항공사 (제주항공, 진에어, 티웨이 등)
   - ✈️ FSC: 일반항공사 (대한항공, 아시아나)
4. **시간대 필터**: 
   - 가는편: 출발 시간 범위 (예: 오전 6시 ~ 오후 6시)
   - 오는편: 귀국편 출발 시간 범위
5. **가격대 필터**: 최소/최대 가격 설정 (만원 단위)
6. **최대 경유 횟수**: 허용할 최대 환승 횟수

---

## 🚀 고급 기능

### 🌍 다중 목적지 검색

여러 목적지의 가격을 한 번에 비교하려면:

1. 헤더의 **🌍 다중 목적지** 버튼 클릭
2. 출발지 선택
3. 비교할 **도착지 2개 이상** 체크 (예: 도쿄, 오사카, 후쿠오카)
4. 날짜 및 인원 설정
5. **🔍 다중 검색 시작** 클릭
6. 결과: 각 목적지별 최저가 비교표 표시

### 📅 날짜 범위 검색

가장 저렴한 출발 날짜를 찾으려면:

1. 헤더의 **📅 날짜 범위** 버튼 클릭
2. 출발지/도착지 선택
3. **검색 시작일 ~ 종료일** 설정 (예: 1월 1일 ~ 1월 15일)
4. **여행 기간** 설정 (예: 3박)
5. **🔍 날짜 검색 시작** 클릭
6. 결과: 각 날짜별 최저가 표시

> ⚠️ 날짜 범위가 넓을수록 검색 시간이 오래 걸립니다 (14일 이상 시 확인 메시지 표시)

### 📆 캘린더 뷰

날짜범위 검색 후 시각적으로 최저가를 확인:

1. 먼저 **📅 날짜 범위** 검색 수행
2. 헤더의 **📆 캘린더뷰** 버튼 클릭
3. 캘린더에서 각 날짜별 가격 색상 확인:
   - 🟢 녹색: 최저가 (하위 30%)
   - 🟡 노랑: 중간 (30~60%)
   - 🔴 빨강: 고가 (상위 40%)
4. 날짜 클릭 시 해당 날짜로 검색 조건 변경

### 🔔 가격 알림

목표 가격 도달 시 알림 받기:

1. 헤더의 **🔔 가격알림** 버튼 클릭
2. **➕ 새 알림 추가** 섹션에서:
   - 출발지/도착지 선택
   - 여행 날짜 설정
   - 필요 시 **편도 알림** 체크 (귀국일 없이 감시)
   - **목표 가격** 입력 (예: 300,000원)
3. **🔔 알림 추가** 클릭
4. 다음 검색 시 목표 가격 이하 발견 시 알림

### 💾 세션 저장 및 불러오기

검색 결과를 파일로 저장/복원:

**저장하기:**
1. 검색 완료 후 헤더의 **💾** 버튼 클릭
2. 저장 위치 및 파일명 지정
3. JSON 파일로 저장

**불러오기:**
1. 헤더의 **📂** 버튼 클릭
2. 저장된 .json 파일 선택
3. 검색 조건 및 결과 복원

### 📊 결과 내보내기

| 형식 | 방법 |
|------|------|
| CSV | 결과 헤더의 **📥 CSV 저장** 클릭 |
| Excel | 테이블 우클릭 → **📊 Excel로 내보내기** |
| 클립보드 | 결과 헤더의 **📋 복사** 클릭 |

---

## ⌨️ 키보드 단축키

| 단축키 | 기능 |
|--------|------|
| `Ctrl+Enter` | 검색 시작 |
| `F5` | 결과 새로고침 (필터 재적용) |
| `Escape` | 검색 취소 / 다이얼로그 닫기 |
| `Ctrl+F` | 필터 영역으로 포커스 이동 |
| `더블클릭` | 해당 항공편 예약 페이지 열기 |

> 💡 **⌨️** 버튼을 클릭하면 단축키 목록을 볼 수 있습니다.

---

## 📁 프로젝트 구조

```
Scraping-flight-information-main-v2/
├── gui_v2.py              # 메인 애플리케이션 (MainWindow)
├── scraper_v2.py          # Playwright 스크래퍼 엔진
├── scraper_config.py      # 스크래핑 설정 및 JavaScript
├── database.py            # SQLite 데이터베이스 관리
├── config.py              # 공항 코드, 설정 관리
├── requirements.txt       # 의존성 패키지 목록
├── flight_bot.spec        # PyInstaller 빌드 스펙
│
├── ui/                    # UI 컴포넌트 모듈
│   ├── styles.py          # 테마 스타일시트 (다크/라이트)
│   ├── components.py      # 재사용 UI 위젯
│   ├── dialogs.py         # 팝업 다이얼로그
│   └── workers.py         # 백그라운드 워커 스레드
│
├── gemini.md              # AI 가이드라인 (Gemini용)
├── claude.md              # AI 가이드라인 (Claude용)
└── README.md              # 프로젝트 문서 (현재 파일)
```

### 모듈별 역할

| 모듈 | 역할 |
|------|------|
| `gui_v2.py` | 메인 윈도우, 이벤트 처리, 탭 관리 |
| `scraper_v2.py` | Playwright 브라우저 제어, 데이터 추출 |
| `database.py` | SQLite 즐겨찾기, 가격 히스토리, 알림 관리 |
| `config.py` | 공항/도시 코드, 사용자 설정 |
| `ui/components.py` | FilterPanel, ResultTable, SearchPanel |
| `ui/workers.py` | SearchWorker, MultiSearchWorker |

---

## 🔧 설정

### 사용자 설정 파일

| 모드 | preferences.json 위치 | flight_data.db 위치 |
|------|----------------------|---------------------|
| 개발 | `./preferences.json` | `./flight_data.db` |
| EXE | `%LOCALAPPDATA%/FlightBot/` | `%LOCALAPPDATA%/FlightBot/` |

### 설정 가능 항목

⚙️ **설정** 버튼에서 변경 가능:

- **최대 결과 수**: 표시할 최대 검색 결과 수 (기본: 1000)
- **선호 출발 시간**: 기본 필터 시간대 설정
- **프리셋 관리**: 자주 사용하는 공항 코드 추가
- **테마**: 다크/라이트 모드 전환

### 프리셋 공항 추가

1. 검색 패널에서 출발지/도착지 옆 **➕** 버튼 클릭
2. 3자리 공항 코드 입력 (예: HND)
3. 공항명 입력 (예: 하네다)
4. 저장 후 드롭다운에서 사용 가능

---

## 📦 빌드 (EXE 생성)

### PyInstaller 빌드

```bash
# 스펙 파일 사용 (권장)
pyinstaller --clean flight_bot.spec

# 또는 직접 빌드
pyinstaller --onedir --windowed --name FlightBot_v2.5 gui_v2.py
```

### 빌드 결과

- `dist/FlightBot_v2.5/` 폴더 생성
- `FlightBot_v2.5.exe` 실행 파일
- 예상 크기: 80-120MB (Playwright 포함)

### 빌드 후 필수 작업

```bash
# Chromium 브라우저 설치 (최초 1회)
playwright install chromium
```

> 또는 사용자 PC에 Chrome/Edge가 설치되어 있으면 자동 사용됩니다.

---

## ❓ 문제 해결

### "브라우저를 찾을 수 없습니다"

**해결책:**
```bash
playwright install chromium
```
또는 Chrome/Edge 설치 후 재실행

### "검색 결과 없음"

**가능한 원인:**
1. 해당 노선에 항공편이 없음
2. 네트워크 연결 문제
3. 인터파크 페이지 구조 변경

**해결책:**
- 수동 모드 전환 시 직접 브라우저에서 검색 후 데이터 추출 가능
- 수동 모드 브라우저는 유지되며 필요 시 **브라우저 닫기** 버튼으로 종료
- 다른 날짜나 노선으로 테스트

### 검색 속도가 느림

**해결책:**
- 네트워크 상태 확인
- 결과 수 제한 (설정에서 조정)
- 날짜 범위 검색 시 범위 축소

### 프로그램이 응답 없음

**해결책:**
- `Escape` 키로 검색 취소
- 작업 관리자에서 Python/Chrome 프로세스 종료 후 재시작

---

## 📝 변경 로그

### v2.5 (2026-01-10)
- 🛡️ **안정성 및 리소스 관리 대폭 개선** (Critical Fixes)
  - 검색 중단(Cancel) 요청 시 즉각 반응하도록 로직 개선
  - 브라우저 종료 시 리소스 누수(좀비 프로세스) 원천 차단
  - 수동 모드 종료 시 메모리 누수 수정
  
- 🔌 **구조적 개선**
  - 데이터베이스 Multi-thread 안전성 확보 (Thread-Local Connection)
  - 브라우저 초기화 오류 시 사용자 친화적 메시지 표시
  - 로깅 시스템 통합 및 최적화
  
- 🐛 **버그 수정**
  - 고가 항공권 필터링 로직 오류 수정
  - 데이터 직렬화(to_dict) 누락 필드 보완
  
- 📄 **문서화**
  - AI 가이드라인 문서 추가 (gemini.md, claude.md)
  - README.md 사용 방법 상세화

### v2.4 (2026-01-05)
- 🎨 **UI/UX 전면 리팩토링**
  - 프리미엄 그라데이션 버튼 (#667eea → #764ba2 → #f093fb)
  - 강화된 glassmorphism 카드 효과
  - 현대적인 탭/테이블 스타일
  - Empty State 처리 추가
  
- ⚡ **성능 최적화**
  - 국내선 조합 생성 확대 (150×150 = 22,500개)
  - 화면 표시 결과 증가 (500 → 1,000개)
  - 스크롤 대기 시간 40% 단축
  - SQLite WAL 모드 활성화
  - 연결 캐싱으로 DB 성능 향상

### v2.3
- Playwright 기반 스크래핑 엔진
- 국내선 왕복 조합 검색
- 수동 모드 지원

---

## ⚠️ 주의 사항

> **법적 고지**: 이 도구는 개인 사용 목적으로 제작되었습니다.

1. **인터넷 연결** 필요
2. **Chrome, Edge, 또는 Chromium** 중 하나 설치 필요
3. 검색 빈도가 높으면 인터파크에서 **일시적 차단**될 수 있음
4. 상업적 목적 사용 시 관련 **법률 및 서비스 약관** 확인 필요
5. 항공권 가격은 실시간 변동될 수 있으며, 실제 예약 가격과 다를 수 있음

---

## 📄 라이선스

MIT License

Copyright (c) 2026

---

## 🙏 기여

버그 리포트, 기능 제안, PR 환영합니다!

### 기여 방법

1. 이 저장소 Fork
2. Feature 브랜치 생성 (`git checkout -b feature/AmazingFeature`)
3. 변경사항 커밋 (`git commit -m 'Add some AmazingFeature'`)
4. 브랜치 Push (`git push origin feature/AmazingFeature`)
5. Pull Request 생성

### 개발 환경 설정

```bash
# 개발 의존성 설치
pip install -r requirements.txt

# 코드 실행 (디버그 모드)
python gui_v2.py

# 테스트 실행
pytest -q
```

---

## 📞 지원

- **이슈 트래커**: GitHub Issues
- **문서**: 이 README 및 gemini.md, claude.md 참조

---

*Made with ❤️ for travelers*
